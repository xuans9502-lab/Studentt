<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C√ÄY CHU·ªñI ¬∑ K·∫æT B·∫†N ¬∑ L·ª¨A T√çM ¬∑ PET HUY·ªÄN THO·∫†I</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
        }

        body {
            background: #030514;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 16px;
            background-image: 
                radial-gradient(circle at 10% 20%, #1a0f2a 0%, #030514 90%),
                url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><circle cx="50" cy="50" r="1" fill="%23ffd966" opacity="0.3"/><circle cx="20" cy="30" r="1" fill="%23ff5e9e" opacity="0.3"/><circle cx="80" cy="70" r="1" fill="%239d4eff" opacity="0.3"/></svg>');
            animation: stars 20s linear infinite;
        }

        @keyframes stars {
            from { background-position: 0 0; }
            to { background-position: 100px 100px; }
        }

        .phone {
            max-width: 500px;
            width: 100%;
            background: rgba(20, 10, 40, 0.9);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-radius: 60px;
            padding: 24px 18px;
            box-shadow: 0 30px 50px #000000, 0 0 0 3px #ffd96680, 0 0 50px #9d4eff;
            border: 2px solid #9d4eff;
            color: #fff5e6;
            position: relative;
            overflow: hidden;
        }

        .phone::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 215, 0, 0.1), rgba(157, 78, 255, 0.1), transparent);
            animation: shine 8s linear infinite;
            pointer-events: none;
        }

        @keyframes shine {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* header */
        .top {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 24px;
            background: rgba(157, 78, 255, 0.2);
            padding: 16px;
            border-radius: 60px;
            border: 2px solid #9d4eff;
            position: relative;
            z-index: 1;
            backdrop-filter: blur(10px);
        }

        .avatar {
            width: 80px;
            height: 80px;
            background: linear-gradient(145deg, gold, #ffae42, #9d4eff);
            border-radius: 40% 60% 30% 70% / 50% 40% 60% 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 42px;
            font-weight: 800;
            color: white;
            box-shadow: 0 8px 30px #9d4eff;
            border: 3px solid white;
            animation: avatarGlow 3s infinite;
        }

        @keyframes avatarGlow {
            0%, 100% { box-shadow: 0 8px 30px #9d4eff; }
            50% { box-shadow: 0 8px 50px #ff5e9e; }
        }

        .name h1 {
            font-size: 28px;
            font-weight: 900;
            background: linear-gradient(to right, #fff, #ffd966, #9d4eff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px #9d4eff;
        }

        .name .class {
            background: #2a1f4a;
            border-radius: 40px;
            padding: 6px 18px;
            font-size: 14px;
            border: 2px solid #9d4eff;
            width: fit-content;
            margin-top: 8px;
            font-weight: 700;
            color: #ffd966;
        }

        /* Tab chuy·ªÉn ƒë·ªïi ƒêƒÉng k√Ω / ƒêƒÉng nh·∫≠p */
        .auth-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .auth-tab {
            flex: 1;
            background: rgba(30, 15, 50, 0.7);
            border: 2px solid #9d4eff;
            border-radius: 40px;
            padding: 16px;
            text-align: center;
            font-size: 18px;
            font-weight: 900;
            color: #b0c0ff;
            cursor: pointer;
            transition: 0.3s;
            backdrop-filter: blur(10px);
        }

        .auth-tab.active {
            background: #9d4eff;
            color: white;
            box-shadow: 0 0 30px #9d4eff;
            border-color: gold;
        }

        /* Form ƒëƒÉng k√Ω / ƒëƒÉng nh·∫≠p */
        .auth-section {
            background: rgba(30, 15, 50, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 50px;
            padding: 22px;
            margin-bottom: 20px;
            border: 3px solid #9d4eff;
            box-shadow: 0 0 30px #9d4eff;
        }

        .auth-title {
            font-size: 22px;
            font-weight: 900;
            margin-bottom: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #9d4eff;
            text-shadow: 0 0 20px #9d4eff;
        }

        .auth-box {
            background: #1a0f2a;
            border-radius: 40px;
            padding: 30px;
            border: 3px solid #9d4eff;
            text-align: center;
        }

        .auth-box input {
            width: 100%;
            background: #2a1f4a;
            border: 3px solid #9d4eff;
            border-radius: 60px;
            padding: 16px 20px;
            font-size: 18px;
            color: white;
            outline: none;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
        }

        .auth-box input:focus {
            border-color: gold;
            box-shadow: 0 0 30px gold;
        }

        .auth-box input::placeholder {
            color: #b0c0ff;
            opacity: 0.7;
        }

        .btn {
            background: linear-gradient(145deg, gold, #ffae42);
            border: none;
            border-radius: 60px;
            padding: 16px 28px;
            font-size: 18px;
            font-weight: 900;
            color: #0a0c18;
            cursor: pointer;
            box-shadow: 0 8px 0 #b26f00, 0 0 20px gold;
            transition: 0.1s;
            border: 2px solid white;
            width: 100%;
        }

        .btn:active {
            transform: translateY(6px);
            box-shadow: 0 2px 0 #b26f00, 0 0 30px gold;
        }

        .btn.purple {
            background: linear-gradient(145deg, #9d4eff, #6b2fbf);
            box-shadow: 0 8px 0 #4a1f8a, 0 0 20px #9d4eff;
        }

        .btn.small {
            padding: 8px 16px;
            font-size: 14px;
            width: auto;
        }

        .btn.pink {
            background: linear-gradient(145deg, #ff5e9e, #ff2e7a);
            box-shadow: 0 5px 0 #a01a4a;
        }

        /* MAIN APP */
        #mainApp {
            display: none;
        }

        /* Navigation */
        .nav-tabs {
            display: flex;
            gap: 5px;
            margin: 15px 0;
            background: rgba(30, 15, 50, 0.5);
            padding: 10px;
            border-radius: 60px;
            border: 2px solid #9d4eff;
            flex-wrap: wrap;
        }

        .nav-tab {
            flex: 1;
            text-align: center;
            padding: 10px 5px;
            border-radius: 40px;
            cursor: pointer;
            font-weight: 700;
            font-size: 13px;
            transition: 0.3s;
            color: #b0c0ff;
        }

        .nav-tab.active {
            background: #9d4eff;
            color: white;
            box-shadow: 0 0 20px #9d4eff;
        }

        /* Sections */
        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        /* Reset Timer */
        .reset-timer {
            background: linear-gradient(145deg, #4a1e4a, #2a1f4a);
            border-radius: 40px;
            padding: 12px;
            margin: 10px 0;
            border: 3px solid gold;
            text-align: center;
            animation: timerPulse 2s infinite;
        }

        @keyframes timerPulse {
            0%, 100% { box-shadow: 0 0 20px gold; }
            50% { box-shadow: 0 0 40px #ff5e9e; }
        }

        .reset-timer .days {
            font-size: 32px;
            font-weight: 900;
            color: gold;
        }

        .reset-timer .label {
            font-size: 14px;
            color: #ff9ec0;
        }

        /* Th√¥ng tin user */
        .user-stats {
            display: flex;
            justify-content: space-between;
            background: rgba(30, 15, 50, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 40px;
            padding: 16px;
            margin: 10px 0;
            border: 2px solid #9d4eff;
            box-shadow: 0 0 30px #9d4eff;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 900;
            color: gold;
            text-shadow: 0 0 20px gold;
        }

        .stat-label {
            font-size: 14px;
            color: #ff9ec0;
        }

        /* Rank bar */
        .rank-bar {
            background: rgba(30, 15, 50, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 60px;
            padding: 16px;
            margin: 15px 0;
            border: 3px solid #9d4eff;
            box-shadow: 0 0 30px #9d4eff;
        }

        .rank-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .rank-name {
            font-size: 22px;
            font-weight: 900;
            color: gold;
            text-shadow: 0 0 20px gold;
        }

        .exp-bar {
            width: 100%;
            height: 20px;
            background: #1a0f2a;
            border-radius: 30px;
            overflow: hidden;
            border: 2px solid #9d4eff;
        }

        .exp-fill {
            height: 100%;
            background: linear-gradient(90deg, #ffae42, gold, #9d4eff);
            width: 0%;
            transition: width 0.3s;
            box-shadow: 0 0 20px #9d4eff;
        }

        /* streak v√† t√™n */
        .streak-name {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(30, 15, 50, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 40px;
            padding: 16px 20px;
            margin: 20px 0;
            border: 3px solid #9d4eff;
            box-shadow: 0 0 30px #9d4eff;
        }

        .user-name-display {
            font-size: 26px;
            font-weight: 900;
            color: gold;
            text-shadow: 0 0 20px gold;
        }

        .current-streak {
            font-size: 26px;
            font-weight: 900;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .fire-icon {
            font-size: 32px;
            filter: drop-shadow(0 0 20px #ff8c42);
            transition: all 0.3s;
        }

        .fire-icon.purple {
            filter: drop-shadow(0 0 30px #9d4eff);
            color: #b87cff;
        }

        /* Buff bar */
        .buff-bar {
            display: flex;
            gap: 10px;
            margin: 10px 0;
            flex-wrap: wrap;
        }

        .buff-item {
            background: #2a1f4a;
            border-radius: 30px;
            padding: 8px 15px;
            font-size: 12px;
            border: 2px solid gold;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .buff-item.active {
            animation: buffPulse 1s infinite;
        }

        @keyframes buffPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* PET SYSTEM */
        .pet-section {
            background: rgba(30, 15, 50, 0.8);
            border-radius: 40px;
            padding: 18px;
            margin: 15px 0;
            border: 3px solid #ff5e9e;
        }

        .pet-showcase {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 10px 0;
        }

        .pet-card {
            min-width: 100px;
            background: #2a1f4a;
            border-radius: 30px;
            padding: 15px 10px;
            text-align: center;
            border: 2px solid #9d4eff;
            cursor: pointer;
            transition: 0.3s;
        }

        .pet-card:hover {
            transform: scale(1.05);
            border-color: gold;
        }

        .pet-card.equipped {
            border-color: gold;
            box-shadow: 0 0 30px gold;
            animation: petShine 2s infinite;
        }

        @keyframes petShine {
            0% { filter: drop-shadow(0 0 5px gold); }
            50% { filter: drop-shadow(0 0 20px gold); }
            100% { filter: drop-shadow(0 0 5px gold); }
        }

        .pet-emoji {
            font-size: 48px;
            animation: petFloat 3s infinite;
        }

        @keyframes petFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .pet-name {
            font-size: 14px;
            font-weight: 700;
            margin: 5px 0;
        }

        .pet-buff {
            font-size: 11px;
            background: #4a1f4a;
            padding: 3px;
            border-radius: 20px;
            margin-top: 5px;
        }

        .pet-price {
            font-size: 12px;
            color: #ff5e9e;
            font-weight: 900;
        }

        .pet-mythical {
            position: absolute;
            top: -5px;
            right: -5px;
            background: linear-gradient(145deg, gold, purple);
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            border: 2px solid white;
        }

        /* PET HUY·ªÄN THO·∫†I */
        .mythical-pet-section {
            background: linear-gradient(145deg, #4a1f6a, #2a1f5a);
            border-radius: 40px;
            padding: 18px;
            margin: 15px 0;
            border: 3px solid gold;
            animation: mythicalGlow 3s infinite;
        }

        @keyframes mythicalGlow {
            0%, 100% { box-shadow: 0 0 30px gold; }
            50% { box-shadow: 0 0 60px #ff00ff; }
        }

        .friends-title {
            font-size: 20px;
            font-weight: 900;
            margin-bottom: 15px;
            color: #ff9ec0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* M√îN H·ªåC */
        .subject-detail {
            background: #2a1f4a;
            border-radius: 40px;
            padding: 15px;
            margin: 10px 0;
            border: 3px solid #9d4eff;
        }

        .subject-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .subject-icon {
            font-size: 40px;
        }

        .subject-title {
            font-size: 24px;
            font-weight: 900;
            color: gold;
        }

        .sub-tasks {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .sub-task {
            flex: 1;
            background: #1a0f2a;
            border-radius: 30px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            border: 2px solid #ff5e9e;
            transition: 0.2s;
        }

        .sub-task.done {
            border-color: gold;
            background: #3a2f5a;
            box-shadow: 0 0 20px gold;
        }

        .sub-task-emoji {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .sub-task-name {
            font-size: 12px;
            font-weight: 700;
        }

        .progress-bar-container {
            margin: 10px 0;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #1a0f2a;
            border-radius: 20px;
            overflow: hidden;
            border: 2px solid #9d4eff;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ffae42, gold);
            width: 0%;
            transition: width 0.3s;
        }

        /* Kho ƒë·ªì */
        .inventory-section {
            background: rgba(30, 15, 50, 0.8);
            border-radius: 40px;
            padding: 18px;
            margin: 15px 0;
            border: 3px solid #9d4eff;
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
        }

        .inventory-item {
            background: #2a1f4a;
            border-radius: 20px;
            padding: 10px;
            text-align: center;
            border: 2px solid #ff5e9e;
            cursor: pointer;
            transition: 0.2s;
        }

        .inventory-item:hover {
            transform: scale(1.05);
            border-color: gold;
        }

        /* B·∫°n b√® */
        .friends-section {
            background: rgba(30, 15, 50, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 40px;
            padding: 18px;
            margin: 15px 0;
            border: 3px solid #ff5e9e;
        }

        .friend-search {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .friend-search input {
            flex: 1;
            background: #2a1f4a;
            border: 3px solid #ff5e9e;
            border-radius: 60px;
            padding: 12px 16px;
            font-size: 16px;
            color: white;
            outline: none;
        }

        .friend-search input::placeholder {
            color: #b0c0ff;
            opacity: 0.7;
        }

        .friend-search button {
            background: linear-gradient(145deg, #ff5e9e, #ff2e7a);
            border: none;
            border-radius: 60px;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: 900;
            color: white;
            cursor: pointer;
            box-shadow: 0 5px 0 #a01a4a;
            border: 2px solid white;
        }

        .friend-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 300px;
            overflow-y: auto;
            padding: 5px;
        }

        .friend-item {
            background: #2a1f4a;
            border-radius: 40px;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border: 2px solid #ff5e9e;
        }

        .friend-name {
            font-weight: 700;
            color: gold;
        }

        .friend-streak {
            font-size: 14px;
            color: #ff9ec0;
        }

        .friend-actions button {
            background: #9d4eff;
            border: none;
            border-radius: 40px;
            padding: 6px 12px;
            font-size: 12px;
            font-weight: 700;
            color: white;
            cursor: pointer;
            border: 2px solid white;
            margin: 2px;
        }

        .search-result {
            background: #2a1f4a;
            border-radius: 40px;
            padding: 16px;
            margin-top: 10px;
            text-align: center;
            border: 2px solid #ff5e9e;
        }

        /* B·∫£ng x·∫øp h·∫°ng */
        .leaderboard-section {
            background: rgba(30, 15, 50, 0.8);
            border-radius: 40px;
            padding: 18px;
            margin: 15px 0;
            border: 3px solid gold;
        }

        .friend-leaderboard {
            background: #2a1f4a;
            border-radius: 30px;
            padding: 15px;
        }

        .friend-leaderboard-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            border-bottom: 1px solid #9d4eff;
        }

        .friend-rank-badge {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #9d4eff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 900;
        }

        /* C√∫p */
        .cup-showcase {
            display: flex;
            justify-content: space-around;
            margin: 15px 0;
        }

        .cup-item {
            text-align: center;
            padding: 10px;
            background: #2a1f4a;
            border-radius: 30px;
            border: 2px solid gold;
            width: 80px;
        }

        .cup-emoji {
            font-size: 32px;
        }

        .cup-name {
            font-size: 10px;
            font-weight: 700;
        }

        /* Shop */
        .shop-section {
            background: rgba(30, 15, 50, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 40px;
            padding: 18px;
            margin: 20px 0;
            border: 3px solid #ff5e9e;
            box-shadow: 0 0 30px #ff5e9e;
        }

        .shop-title {
            font-size: 22px;
            font-weight: 900;
            margin-bottom: 16px;
            color: #ff9ec0;
            text-shadow: 0 0 20px #ff5e9e;
        }

        .shop-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            max-height: 300px;
            overflow-y: auto;
            padding: 5px;
        }

        .shop-item {
            background: #2a1f4a;
            border-radius: 30px;
            padding: 16px 8px;
            text-align: center;
            border: 2px solid #ff5e9e;
            cursor: pointer;
            transition: 0.2s;
            box-shadow: 0 5px 0 #4a1f4a;
        }

        .shop-item:hover {
            transform: scale(1.05);
            border-color: gold;
            box-shadow: 0 0 30px gold;
        }

        .shop-item-emoji {
            font-size: 32px;
        }

        .shop-item-name {
            font-size: 14px;
            font-weight: 700;
            margin: 5px 0;
        }

        .shop-item-price {
            color: gold;
            font-weight: 900;
        }

        /* Warning */
        .warning {
            background: #4a1e2e;
            border-radius: 40px;
            padding: 18px;
            margin-top: 25px;
            font-size: 18px;
            color: #ffc3c3;
            font-weight: 700;
            border: 3px solid red;
            animation: warningPulse 2s infinite;
        }

        @keyframes warningPulse {
            0%, 100% { box-shadow: 0 0 20px red; }
            50% { box-shadow: 0 0 40px #ff6b6b; }
        }

        .logout-btn {
            background: #4a1e4a;
            border: 2px solid #ff5e9e;
            color: white;
            padding: 10px;
            border-radius: 40px;
            margin: 10px 0;
            cursor: pointer;
            text-align: center;
        }

        .footer-note {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
            color: #b0c0ff;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="phone">
        <!-- header -->
        <div class="top">
            <div class="avatar">üëë</div>
            <div class="name">
                <h1>C√ÄY CHU·ªñI</h1>
                <div class="class">VIP ¬∑ K·∫æT B·∫†N ¬∑ L·ª¨A T√çM ¬∑ PET</div>
            </div>
        </div>

        <!-- PH·∫¶N ƒêƒÇNG K√ù/ƒêƒÇNG NH·∫¨P G·ªêC -->
        <div class="auth-tabs" id="authTabs">
            <div class="auth-tab active" id="registerTab">üìù ƒêƒÇNG K√ù</div>
            <div class="auth-tab" id="loginTab">üîë ƒêƒÇNG NH·∫¨P</div>
        </div>

        <!-- Form ƒêƒÇNG K√ù -->
        <div class="auth-section" id="registerSection">
            <div class="auth-title">üî∞ T·∫†O T√ÄI KHO·∫¢N M·ªöI</div>
            <div class="auth-box">
                <input type="text" id="regUsername" placeholder="T√™n t√†i kho·∫£n..." maxlength="20">
                <input type="password" id="regPassword" placeholder="M·∫≠t kh·∫©u...">
                <input type="password" id="regConfirmPassword" placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u...">
                <button class="btn purple" id="registerBtn">üî∞ ƒêƒÇNG K√ù</button>
            </div>
        </div>

        <!-- Form ƒêƒÇNG NH·∫¨P -->
        <div class="auth-section" id="loginSection" style="display: none;">
            <div class="auth-title">üîë ƒêƒÇNG NH·∫¨P</div>
            <div class="auth-box">
                <input type="text" id="loginUsername" placeholder="T√™n t√†i kho·∫£n...">
                <input type="password" id="loginPassword" placeholder="M·∫≠t kh·∫©u...">
                <button class="btn purple" id="loginBtn">üîë ƒêƒÇNG NH·∫¨P</button>
            </div>
        </div>

        <!-- MAIN APP (·∫®N KHI CH∆ØA ƒêƒÇNG NH·∫¨P) -->
        <div id="mainApp">
            <!-- N√∫t ƒëƒÉng xu·∫•t -->
            <div class="logout-btn" id="logoutBtn">üö™ ƒêƒÇNG XU·∫§T</div>

            <!-- Navigation -->
            <div class="nav-tabs">
                <div class="nav-tab active" data-section="home">üè† HOME</div>
                <div class="nav-tab" data-section="study">üìö H·ªåC</div>
                <div class="nav-tab" data-section="pets">üêæ PET</div>
                <div class="nav-tab" data-section="friends">üë• B·∫†N</div>
                <div class="nav-tab" data-section="rank">üèÜ RANK</div>
                <div class="nav-tab" data-section="shop">üõí SHOP</div>
            </div>

            <!-- HOME SECTION -->
            <div class="section active" id="homeSection">
                <!-- Reset Timer -->
                <div class="reset-timer" id="resetTimer">
                    <span class="cup-icon">üèÜ</span>
                    <span class="days" id="daysUntilReset">30</span>
                    <span class="label">ng√†y c√≤n l·∫°i ƒë·∫øn RESET RANK</span>
                </div>

                <!-- User Info -->
                <div class="streak-name">
                    <span class="user-name-display" id="userNameDisplay">---</span>
                    <div class="current-streak">
                        <span id="streakNum">0</span>
                        <span class="fire-icon" id="fireIcon">üî•</span>
                    </div>
                </div>

                <!-- Stats -->
                <div class="user-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="diamondNum">50</div>
                        <div class="stat-label">üíé</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="expNum">0</div>
                        <div class="stat-label">‚ú®</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="starNum">0</div>
                        <div class="stat-label">‚≠ê</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="cupNum">0</div>
                        <div class="stat-label">üèÜ</div>
                    </div>
                </div>

                <!-- Rank -->
                <div class="rank-bar">
                    <div class="rank-info">
                        <span class="rank-name" id="rankName">G·ªó</span>
                        <span id="expDisplay">0/100 EXP</span>
                    </div>
                    <div class="exp-bar">
                        <div class="exp-fill" id="expBar" style="width: 0%"></div>
                    </div>
                </div>

                <!-- Active Buffs -->
                <div class="buff-bar" id="buffBar"></div>

                <!-- Current Pet -->
                <div class="pet-section" id="currentPetDisplay">
                    <div style="text-align: center; color: #b0c0ff;">Trang b·ªã pet ƒë·ªÉ nh·∫≠n buff</div>
                </div>

                <!-- Milestone -->
                <div class="milestone-box" id="milestoneBox">
                    <div class="locked">üîí ƒê·∫°t streak ƒë·ªÉ nh·∫≠n qu√†</div>
                </div>
            </div>

            <!-- STUDY SECTION -->
            <div class="section" id="studySection">
                <div class="section-title">üìö M√îN H·ªåC (L√ù THUY·∫æT + B√ÄI T·∫¨P)</div>
                <div id="subjectDetails"></div>
                <div class="warning" id="warningMsg">
                    ‚ö†Ô∏è Ho√†n th√†nh ƒë·ªß 4 m√¥n ƒë·ªÉ +1 streak
                </div>
            </div>

            <!-- PET SECTION -->
            <div class="section" id="petsSection">
                <!-- Pet Inventory -->
                <div class="pet-section">
                    <div class="friends-title">üêæ PET C·ª¶A B·∫†N</div>
                    <div class="pet-showcase" id="petInventory"></div>
                </div>

                <!-- 5 PET HUY·ªÄN THO·∫†I -->
                <div class="mythical-pet-section">
                    <div class="friends-title" style="color: gold;">üëë 5 PET HUY·ªÄN THO·∫†I</div>
                    <div class="pet-showcase" id="mythicalPets"></div>
                </div>

                <!-- Shop Pet -->
                <div class="shop-section">
                    <div class="shop-title">üõí MUA PET</div>
                    <div class="shop-grid" id="petShop"></div>
                </div>
            </div>

            <!-- FRIENDS SECTION -->
            <div class="section" id="friendsSection">
                <!-- Friend Leaderboard -->
                <div class="leaderboard-section">
                    <div class="friends-title">üèÜ B·∫¢NG X·∫æP H·∫†NG B·∫†N B√à</div>
                    <div class="friend-leaderboard" id="friendLeaderboard"></div>
                </div>

                <!-- Friend List -->
                <div class="friends-section">
                    <div class="friends-title">üë• DANH S√ÅCH B·∫†N B√à</div>
                    <div class="friend-search">
                        <input type="text" id="searchFriendInput" placeholder="Nh·∫≠p t√™n b·∫°n b√®...">
                        <button id="searchFriendBtn">üîç T√åM</button>
                    </div>
                    <div class="search-result" id="searchFriendResult">
                        üîç Nh·∫≠p t√™n ƒë·ªÉ t√¨m ki·∫øm b·∫°n b√®
                    </div>
                    <div class="friend-list" id="friendListContainer"></div>
                </div>
            </div>

            <!-- RANK SECTION -->
            <div class="section" id="rankSection">
                <!-- Monthly Cups -->
                <div class="leaderboard-section">
                    <div class="friends-title">üèÜ C√öP H√ÄNG TH√ÅNG</div>
                    <div class="cup-showcase" id="cupShowcase"></div>
                </div>

                <!-- Global Leaderboard -->
                <div class="leaderboard-section">
                    <div class="friends-title">üåç B·∫¢NG X·∫æP H·∫†NG TO√ÄN C·∫¶U</div>
                    <div id="globalLeaderboard"></div>
                </div>

                <!-- Reset Info -->
                <div class="reset-timer">
                    <span class="days" id="resetDays">30</span>
                    <span class="label">ng√†y ƒë·∫øn RESET - Ai cao nh·∫•t s·∫Ω nh·∫≠n C√öP ƒê·∫∂C BI·ªÜT!</span>
                </div>
            </div>

            <!-- SHOP SECTION -->
            <div class="section" id="shopSection">
                <div class="shop-section">
                    <div class="shop-title">üõí SHOP V≈® TR·ª§</div>
                    <div class="shop-grid" id="shopGrid"></div>
                </div>

                <!-- Inventory -->
                <div class="inventory-section">
                    <div class="friends-title">üì¶ KHO ƒê·ªí</div>
                    <div class="inventory-grid" id="inventoryGrid"></div>
                </div>
            </div>

            <div class="footer-note">
                ‚ú® M·ªëc 50: L·ª≠a t√≠m | M·ªëc 100: 5000 EXP + 5000üíé | M·ªëc 500: SI√äU L·ª¨A T√çM
            </div>
        </div>
    </div>

    <script>
        (function() {
            // D·ªÆ LI·ªÜU
            let accounts = {};
            let currentUser = null;
            let onlineUsers = new Set();

            // 5 PET HUY·ªÄN THO·∫†I
            const MYTHICAL_PETS = [
                { 
                    id: 'dragon_god', 
                    name: 'R·ªíNG TH·∫¶N', 
                    emoji: 'üêâ‚ú®', 
                    price: 50000,
                    buff: { exp: 3.0, diamond: 3.0, streak: 2 },
                    description: 'x3 EXP, x3 üíé, +2 streak/ng√†y'
                },
                { 
                    id: 'phoenix', 
                    name: 'PH∆Ø·ª¢NG HO√ÄNG', 
                    emoji: 'ü¶Öüî•', 
                    price: 45000,
                    buff: { exp: 2.5, diamond: 2.5, rebirth: true },
                    description: 'x2.5 EXP, üíé, h·ªìi sinh 1 l·∫ßn/th√°ng'
                },
                { 
                    id: 'unicorn', 
                    name: 'K·ª≤ L√ÇN', 
                    emoji: 'ü¶Ñ‚ú®', 
                    price: 40000,
                    buff: { diamond: 4.0, luck: true },
                    description: 'x4 üíé, may m·∫Øn g·∫•p ƒë√¥i'
                },
                { 
                    id: 'griffin', 
                    name: 'S∆Ø T·ª¨ ƒê·∫†I B√ÄNG', 
                    emoji: 'ü¶Åü¶Ö', 
                    price: 55000,
                    buff: { exp: 2.0, diamond: 2.0, steal: true },
                    description: 'x2 m·ªçi th·ª©, c∆∞·ªõp 10% EXP b·∫°n b√®'
                },
                { 
                    id: 'cerberus', 
                    name: 'CH√ì 3 ƒê·∫¶U', 
                    emoji: 'üêïüêïüêï', 
                    price: 60000,
                    buff: { exp: 2.0, defense: true, triple: true },
                    description: 'B·∫£o v·ªá streak, nh√¢n 3 ph·∫ßn th∆∞·ªüng'
                }
            ];

            // PET TH∆Ø·ªúNG
            const NORMAL_PETS = [
                { id: 'cat', name: 'M√®o', emoji: 'üê±', price: 100, buff: { exp: 1.1 } },
                { id: 'dog', name: 'Ch√≥', emoji: 'üê∂', price: 150, buff: { diamond: 1.1 } },
                { id: 'hamster', name: 'Hamster', emoji: 'üêπ', price: 80, buff: { streak: 0.1 } },
                { id: 'rabbit', name: 'Th·ªè', emoji: 'üê∞', price: 120, buff: { exp: 1.05, diamond: 1.05 } },
                { id: 'fox', name: 'C√°o', emoji: 'ü¶ä', price: 200, buff: { luck: true } },
                { id: 'panda', name: 'G·∫•u tr√∫c', emoji: 'üêº', price: 300, buff: { exp: 1.2 } },
                { id: 'koala', name: 'Koala', emoji: 'üê®', price: 250, buff: { diamond: 1.15 } },
                { id: 'lion', name: 'S∆∞ t·ª≠', emoji: 'ü¶Å', price: 500, buff: { exp: 1.3 } },
                { id: 'tiger', name: 'H·ªï', emoji: 'üêØ', price: 550, buff: { diamond: 1.25 } },
                { id: 'elephant', name: 'Voi', emoji: 'üêò', price: 800, buff: { exp: 1.15, diamond: 1.15 } }
            ];

            // C√öP H√ÄNG TH√ÅNG
            const MONTHLY_CUPS = [
                { month: 1, name: 'C√öP BƒÇNG', emoji: '‚ùÑÔ∏èüèÜ' },
                { month: 2, name: 'C√öP L·ª¨A', emoji: 'üî•üèÜ' },
                { month: 3, name: 'C√öP ƒê·∫§T', emoji: 'üåçüèÜ' },
                { month: 4, name: 'C√öP GI√ì', emoji: 'üí®üèÜ' },
                { month: 5, name: 'C√öP S·∫§M', emoji: '‚ö°üèÜ' },
                { month: 6, name: 'C√öP M∆ØA', emoji: 'üåßÔ∏èüèÜ' },
                { month: 7, name: 'C√öP C·∫¶U V·ªíNG', emoji: 'üåàüèÜ' },
                { month: 8, name: 'C√öP M·∫∂T TRƒÇNG', emoji: 'üåôüèÜ' },
                { month: 9, name: 'C√öP M·∫∂T TR·ªúI', emoji: '‚òÄÔ∏èüèÜ' },
                { month: 10, name: 'C√öP SAO', emoji: '‚≠êüèÜ' },
                { month: 11, name: 'C√öP THI√äN H√Ä', emoji: 'üååüèÜ' },
                { month: 12, name: 'C√öP V≈® TR·ª§', emoji: 'üå†üèÜ' }
            ];

            // SHOP ITEMS
            const shopItems = [
                { id: 'exp_small', name: '20 EXP', emoji: '‚ú®', price: 20, type: 'exp', value: 20 },
                { id: 'exp_medium', name: '50 EXP', emoji: '‚ú®‚ú®', price: 45, type: 'exp', value: 50 },
                { id: 'exp_large', name: '100 EXP', emoji: '‚ú®‚ú®‚ú®', price: 80, type: 'exp', value: 100 },
                { id: 'diamond_small', name: '10 üíé', emoji: 'üíé', price: 5, type: 'diamonds', value: 10 },
                { id: 'diamond_medium', name: '50 üíé', emoji: 'üíéüíé', price: 20, type: 'diamonds', value: 50 },
                { id: 'diamond_large', name: '200 üíé', emoji: 'üíéüíéüíé', price: 70, type: 'diamonds', value: 200 },
                { id: 'star_small', name: '5 ‚≠ê', emoji: '‚≠ê', price: 30, type: 'stars', value: 5 },
                { id: 'star_medium', name: '20 ‚≠ê', emoji: '‚≠ê‚≠ê', price: 100, type: 'stars', value: 20 },
                { id: 'star_large', name: '50 ‚≠ê', emoji: '‚≠ê‚≠ê‚≠ê', price: 200, type: 'stars', value: 50 },
                { id: 'boost', name: 'Boost Streak', emoji: '‚ö°', price: 50, type: 'boost', value: 1 },
                { id: 'exp_boost', name: 'x2 EXP 7 ng√†y', emoji: '2Ô∏è‚É£', price: 300, type: 'exp_boost', value: 2 },
                { id: 'diamond_boost', name: 'x2 üíé 7 ng√†y', emoji: '2Ô∏è‚É£üíé', price: 300, type: 'diamond_boost', value: 2 }
            ];

            // RANK SYSTEM
            const rankSystem = [
                { tier: 'G·ªó', star: 1, name: 'ü™µ G·ªó 1', minExp: 0, maxExp: 49, resetReward: 10 },
                { tier: 'G·ªó', star: 2, name: 'ü™µ G·ªó 2', minExp: 50, maxExp: 99, resetReward: 20 },
                { tier: 'G·ªó', star: 3, name: 'ü™µ G·ªó 3', minExp: 100, maxExp: 149, resetReward: 30 },
                { tier: 'G·ªó', star: 4, name: 'ü™µ G·ªó 4', minExp: 150, maxExp: 199, resetReward: 40 },
                { tier: 'G·ªó', star: 5, name: 'ü™µ G·ªó 5', minExp: 200, maxExp: 249, resetReward: 50 },
                { tier: 'ƒê·ªìng', star: 1, name: 'ü•â ƒê·ªìng 1', minExp: 250, maxExp: 299, resetReward: 60 },
                { tier: 'ƒê·ªìng', star: 2, name: 'ü•â ƒê·ªìng 2', minExp: 300, maxExp: 349, resetReward: 70 },
                { tier: 'ƒê·ªìng', star: 3, name: 'ü•â ƒê·ªìng 3', minExp: 350, maxExp: 399, resetReward: 80 },
                { tier: 'ƒê·ªìng', star: 4, name: 'ü•â ƒê·ªìng 4', minExp: 400, maxExp: 449, resetReward: 90 },
                { tier: 'ƒê·ªìng', star: 5, name: 'ü•â ƒê·ªìng 5', minExp: 450, maxExp: 499, resetReward: 100 },
                { tier: 'B·∫°c', star: 1, name: 'ü•à B·∫°c 1', minExp: 500, maxExp: 549, resetReward: 120 },
                { tier: 'B·∫°c', star: 2, name: 'ü•à B·∫°c 2', minExp: 550, maxExp: 599, resetReward: 140 },
                { tier: 'B·∫°c', star: 3, name: 'ü•à B·∫°c 3', minExp: 600, maxExp: 649, resetReward: 160 },
                { tier: 'B·∫°c', star: 4, name: 'ü•à B·∫°c 4', minExp: 650, maxExp: 699, resetReward: 180 },
                { tier: 'B·∫°c', star: 5, name: 'ü•à B·∫°c 5', minExp: 700, maxExp: 749, resetReward: 200 },
                { tier: 'V√†ng', star: 1, name: 'ü•á V√†ng 1', minExp: 750, maxExp: 799, resetReward: 250 },
                { tier: 'V√†ng', star: 2, name: 'ü•á V√†ng 2', minExp: 800, maxExp: 849, resetReward: 300 },
                { tier: 'V√†ng', star: 3, name: 'ü•á V√†ng 3', minExp: 850, maxExp: 899, resetReward: 350 },
                { tier: 'V√†ng', star: 4, name: 'ü•á V√†ng 4', minExp: 900, maxExp: 949, resetReward: 400 },
                { tier: 'V√†ng', star: 5, name: 'ü•á V√†ng 5', minExp: 950, maxExp: 999, resetReward: 450 },
                { tier: 'B·∫°ch Kim', star: 1, name: '‚ö™ B·∫°ch Kim 1', minExp: 1000, maxExp: 1099, resetReward: 500 },
                { tier: 'B·∫°ch Kim', star: 2, name: '‚ö™ B·∫°ch Kim 2', minExp: 1100, maxExp: 1199, resetReward: 550 },
                { tier: 'B·∫°ch Kim', star: 3, name: '‚ö™ B·∫°ch Kim 3', minExp: 1200, maxExp: 1299, resetReward: 600 },
                { tier: 'B·∫°ch Kim', star: 4, name: '‚ö™ B·∫°ch Kim 4', minExp: 1300, maxExp: 1399, resetReward: 650 },
                { tier: 'B·∫°ch Kim', star: 5, name: '‚ö™ B·∫°ch Kim 5', minExp: 1400, maxExp: 1499, resetReward: 700 },
                { tier: 'Kim C∆∞∆°ng', star: 1, name: 'üíé Kim C∆∞∆°ng 1', minExp: 1500, maxExp: 1649, resetReward: 800 },
                { tier: 'Kim C∆∞∆°ng', star: 2, name: 'üíé Kim C∆∞∆°ng 2', minExp: 1650, maxExp: 1799, resetReward: 900 },
                { tier: 'Kim C∆∞∆°ng', star: 3, name: 'üíé Kim C∆∞∆°ng 3', minExp: 1800, maxExp: 1949, resetReward: 1000 },
                { tier: 'Kim C∆∞∆°ng', star: 4, name: 'üíé Kim C∆∞∆°ng 4', minExp: 1950, maxExp: 2099, resetReward: 1100 },
                { tier: 'Kim C∆∞∆°ng', star: 5, name: 'üíé Kim C∆∞∆°ng 5', minExp: 2100, maxExp: 2249, resetReward: 1200 },
                { tier: 'Huy·ªÅn Tho·∫°i', star: 1, name: 'üî• Huy·ªÅn Tho·∫°i 1', minExp: 2250, maxExp: 2499, resetReward: 1500 },
                { tier: 'Huy·ªÅn Tho·∫°i', star: 2, name: 'üî• Huy·ªÅn Tho·∫°i 2', minExp: 2500, maxExp: 2749, resetReward: 2000 },
                { tier: 'Huy·ªÅn Tho·∫°i', star: 3, name: 'üî• Huy·ªÅn Tho·∫°i 3', minExp: 2750, maxExp: 2999, resetReward: 2500 },
                { tier: 'Huy·ªÅn Tho·∫°i', star: 4, name: 'üî• Huy·ªÅn Tho·∫°i 4', minExp: 3000, maxExp: 3249, resetReward: 3000 },
                { tier: 'Huy·ªÅn Tho·∫°i', star: 5, name: 'üî• Huy·ªÅn Tho·∫°i 5', minExp: 3250, maxExp: 3499, resetReward: 3500 },
                { tier: 'L·ª≠a T√≠m', star: 1, name: 'üíú L·ª≠a T√≠m 1', minExp: 8500, maxExp: 8749, resetReward: 5000 },
                { tier: 'L·ª≠a T√≠m', star: 2, name: 'üíú L·ª≠a T√≠m 2', minExp: 8750, maxExp: 8999, resetReward: 6000 },
                { tier: 'L·ª≠a T√≠m', star: 3, name: 'üíú L·ª≠a T√≠m 3', minExp: 9000, maxExp: 9249, resetReward: 7000 },
                { tier: 'L·ª≠a T√≠m', star: 4, name: 'üíú L·ª≠a T√≠m 4', minExp: 9250, maxExp: 9499, resetReward: 8000 },
                { tier: 'L·ª≠a T√≠m', star: 5, name: 'üíú L·ª≠a T√≠m 5', minExp: 9500, maxExp: 9749, resetReward: 10000 }
            ];

            // STREAK REWARDS
            const streakRewards = [
                { day: 2, exp: 20, diamonds: 5, stars: 1, emoji: 'üéÆ', name: 'Game th·ªß' },
                { day: 3, exp: 30, diamonds: 8, stars: 1, emoji: 'üç¶', name: 'Kem ng·ªçt' },
                { day: 5, exp: 50, diamonds: 15, stars: 2, emoji: 'üçø', name: 'B·∫Øp rang' },
                { day: 7, exp: 70, diamonds: 25, stars: 2, emoji: 'üßã', name: 'Tr√† s·ªØa' },
                { day: 10, exp: 100, diamonds: 40, stars: 3, emoji: 'üçî', name: 'G√† r√°n' },
                { day: 15, exp: 150, diamonds: 70, stars: 3, emoji: 'üéÅ', name: 'H·ªôp qu√†' },
                { day: 20, exp: 200, diamonds: 100, stars: 4, emoji: 'üß∏', name: 'G·∫•u b√¥ng' },
                { day: 25, exp: 250, diamonds: 150, stars: 4, emoji: 'üéÆ', name: 'Tay c·∫ßm' },
                { day: 30, exp: 300, diamonds: 200, stars: 5, emoji: 'üí∞', name: 'Kho b√°u' },
                { day: 40, exp: 400, diamonds: 300, stars: 6, emoji: 'üëü', name: 'Gi√†y' },
                { day: 50, exp: 500, diamonds: 500, stars: 8, emoji: 'üî•', name: 'L·ª≠a t√≠m', special: 'purplefire' },
                { day: 60, exp: 600, diamonds: 700, stars: 10, emoji: 'üì±', name: 'ƒêi·ªán tho·∫°i' },
                { day: 70, exp: 700, diamonds: 900, stars: 12, emoji: 'üß•', name: '√Åo' },
                { day: 80, exp: 800, diamonds: 1200, stars: 15, emoji: 'üéÇ', name: 'Sinh nh·∫≠t' },
                { day: 90, exp: 900, diamonds: 1500, stars: 18, emoji: 'üï∂Ô∏è', name: 'K√≠nh' },
                { day: 100, exp: 5000, diamonds: 5000, stars: 50, emoji: 'üíú', name: 'ƒê·∫†I TI·ªÜC L·ª¨A T√çM' }
            ];

            function createNewAccount(name, password) {
                return {
                    name: name,
                    password: password,
                    streak: 0,
                    exp: 0,
                    diamonds: 100,
                    stars: 0,
                    cups: [],
                    subjects: {
                        toan: { theory: false, practice: false },
                        van: { theory: false, practice: false },
                        anh: { theory: false, practice: false },
                        khtn: { theory: false, practice: false }
                    },
                    lastDate: new Date().toDateString(),
                    todayCompleted: false,
                    inventory: [],
                    pets: [],
                    equippedPet: null,
                    purpleFire: false,
                    superPurpleFire: false,
                    buffs: {},
                    friends: [],
                    resetHistory: [],
                    highestStreakEver: 0,
                    totalEarned: { exp: 0, diamonds: 0 }
                };
            }

            function getRank(exp) {
                for (let i = rankSystem.length - 1; i >= 0; i--) {
                    if (exp >= rankSystem[i].minExp) return rankSystem[i];
                }
                return rankSystem[0];
            }

            function getNextRankExp(exp) {
                for (let i = 0; i < rankSystem.length; i++) {
                    if (exp < rankSystem[i].minExp) return rankSystem[i].minExp;
                }
                return rankSystem[rankSystem.length - 1].maxExp;
            }

            function calculateBuffs(user) {
                let buffs = { exp: 1.0, diamond: 1.0, streak: 1.0, luck: false };
                
                if (user.equippedPet) {
                    const pet = [...NORMAL_PETS, ...MYTHICAL_PETS].find(p => p.id === user.equippedPet);
                    if (pet && pet.buff) {
                        buffs.exp *= (pet.buff.exp || 1.0);
                        buffs.diamond *= (pet.buff.diamond || 1.0);
                        buffs.streak *= (pet.buff.streak || 1.0);
                        buffs.luck = buffs.luck || pet.buff.luck;
                        
                        if (pet.buff.rebirth) user.buffs.rebirth = true;
                        if (pet.buff.steal) user.buffs.canSteal = true;
                        if (pet.buff.defense) user.buffs.streakProtect = true;
                        if (pet.buff.triple) user.buffs.tripleReward = true;
                    }
                }
                
                return buffs;
            }

            function isSubjectComplete(user, subject) {
                return user.subjects[subject]?.theory && user.subjects[subject]?.practice;
            }

            function calculateReward(baseExp, baseDiamonds, user) {
                const buffs = calculateBuffs(user);
                return {
                    exp: Math.floor(baseExp * buffs.exp),
                    diamonds: Math.floor(baseDiamonds * buffs.diamond)
                };
            }

            function getDaysUntilReset() {
                const now = new Date();
                const nextMonth = new Date(now.getFullYear(), now.getMonth() + 1, 1);
                const diffTime = nextMonth - now;
                return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            }

            // DOM Elements
            const authTabs = document.getElementById('authTabs');
            const registerTab = document.getElementById('registerTab');
            const loginTab = document.getElementById('loginTab');
            const registerSection = document.getElementById('registerSection');
            const loginSection = document.getElementById('loginSection');
            const mainApp = document.getElementById('mainApp');
            
            const regUsername = document.getElementById('regUsername');
            const regPassword = document.getElementById('regPassword');
            const regConfirmPassword = document.getElementById('regConfirmPassword');
            const registerBtn = document.getElementById('registerBtn');
            
            const loginUsername = document.getElementById('loginUsername');
            const loginPassword = document.getElementById('loginPassword');
            const loginBtn = document.getElementById('loginBtn');
            
            const logoutBtn = document.getElementById('logoutBtn');
            
            const navTabs = document.querySelectorAll('.nav-tab');
            const sections = document.querySelectorAll('.section');
            
            const userNameDisplay = document.getElementById('userNameDisplay');
            const streakNum = document.getElementById('streakNum');
            const fireIcon = document.getElementById('fireIcon');
            const diamondNum = document.getElementById('diamondNum');
            const expNum = document.getElementById('expNum');
            const starNum = document.getElementById('starNum');
            const cupNum = document.getElementById('cupNum');
            const rankName = document.getElementById('rankName');
            const expDisplay = document.getElementById('expDisplay');
            const expBar = document.getElementById('expBar');
            const daysUntilReset = document.getElementById('daysUntilReset');
            const resetDays = document.getElementById('resetDays');
            const buffBar = document.getElementById('buffBar');
            const currentPetDisplay = document.getElementById('currentPetDisplay');
            const milestoneBox = document.getElementById('milestoneBox');
            const subjectDetails = document.getElementById('subjectDetails');
            const warningMsg = document.getElementById('warningMsg');
            const petInventory = document.getElementById('petInventory');
            const mythicalPets = document.getElementById('mythicalPets');
            const petShop = document.getElementById('petShop');
            const friendLeaderboard = document.getElementById('friendLeaderboard');
            const searchFriendInput = document.getElementById('searchFriendInput');
            const searchFriendBtn = document.getElementById('searchFriendBtn');
            const searchFriendResult = document.getElementById('searchFriendResult');
            const friendListContainer = document.getElementById('friendListContainer');
            const cupShowcase = document.getElementById('cupShowcase');
            const globalLeaderboard = document.getElementById('globalLeaderboard');
            const shopGrid = document.getElementById('shopGrid');
            const inventoryGrid = document.getElementById('inventoryGrid');

            // Load data
            const savedAccounts = localStorage.getItem('accounts');
            if (savedAccounts) {
                accounts = JSON.parse(savedAccounts);
            }

            // ===== PH·∫¶N ƒêƒÇNG K√ù/ƒêƒÇNG NH·∫¨P =====
            
            // Tab chuy·ªÉn ƒë·ªïi
            registerTab.addEventListener('click', () => {
                registerTab.classList.add('active');
                loginTab.classList.remove('active');
                registerSection.style.display = 'block';
                loginSection.style.display = 'none';
            });

            loginTab.addEventListener('click', () => {
                loginTab.classList.add('active');
                registerTab.classList.remove('active');
                loginSection.style.display = 'block';
                registerSection.style.display = 'none';
            });

            // ƒêƒÇNG K√ù
            registerBtn.addEventListener('click', () => {
                const name = regUsername.value.trim();
                const pwd = regPassword.value;
                const confirm = regConfirmPassword.value;

                if (!name || name.length < 3) {
                    alert('T√™n ph·∫£i c√≥ √≠t nh·∫•t 3 k√Ω t·ª±');
                    return;
                }
                if (!pwd || pwd.length < 3) {
                    alert('M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 3 k√Ω t·ª±');
                    return;
                }
                if (pwd !== confirm) {
                    alert('M·∫≠t kh·∫©u kh√¥ng kh·ªõp');
                    return;
                }
                if (accounts[name]) {
                    alert('T√™n n√†y ƒë√£ t·ªìn t·∫°i!');
                    return;
                }
                
                accounts[name] = createNewAccount(name, pwd);
                localStorage.setItem('accounts', JSON.stringify(accounts));
                
                alert('ƒêƒÉng k√Ω th√†nh c√¥ng! M·ªùi b·∫°n ƒëƒÉng nh·∫≠p');
                
                loginTab.click();
                
                regUsername.value = '';
                regPassword.value = '';
                regConfirmPassword.value = '';
            });

            // ƒêƒÇNG NH·∫¨P
            loginBtn.addEventListener('click', () => {
                const name = loginUsername.value.trim();
                const pwd = loginPassword.value;

                if (!accounts[name]) {
                    alert('T√†i kho·∫£n kh√¥ng t·ªìn t·∫°i');
                    return;
                }
                if (accounts[name].password !== pwd) {
                    alert('Sai m·∫≠t kh·∫©u');
                    return;
                }

                currentUser = name;
                onlineUsers.add(name);
                
                authTabs.style.display = 'none';
                registerSection.style.display = 'none';
                loginSection.style.display = 'none';
                
                mainApp.style.display = 'block';
                
                userNameDisplay.textContent = name;
                
                const user = accounts[name];
                if (user.inventory?.includes('purplefire') || user.streak >= 50) {
                    user.purpleFire = true;
                }
                if (user.inventory?.includes('superPurplefire') || user.streak >= 500) {
                    user.superPurpleFire = true;
                }
                
                if (user.superPurpleFire) {
                    fireIcon.classList.add('purple');
                    fireIcon.style.filter = 'drop-shadow(0 0 30px #ff00ff)';
                } else if (user.purpleFire) {
                    fireIcon.classList.add('purple');
                }
                
                updateUI();
            });

            // ƒêƒÇNG XU·∫§T
            logoutBtn.addEventListener('click', () => {
                if (currentUser) {
                    onlineUsers.delete(currentUser);
                }
                currentUser = null;
                
                authTabs.style.display = 'flex';
                registerSection.style.display = 'block';
                loginSection.style.display = 'none';
                
                mainApp.style.display = 'none';
                
                registerTab.classList.add('active');
                loginTab.classList.remove('active');
                
                loginUsername.value = '';
                loginPassword.value = '';
            });

            // Navigation
            navTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    navTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    const sectionId = tab.dataset.section;
                    sections.forEach(s => s.classList.remove('active'));
                    document.getElementById(sectionId + 'Section').classList.add('active');
                    
                    if (currentUser) {
                        if (sectionId === 'study') renderSubjects();
                        if (sectionId === 'pets') renderPets();
                        if (sectionId === 'friends') renderFriendLeaderboard();
                        if (sectionId === 'rank') renderCups();
                        if (sectionId === 'shop') renderShop();
                    }
                });
            });

            // ===== C√ÅC H√ÄM RENDER =====

            function renderSubjects() {
                if (!currentUser) return;
                
                const user = accounts[currentUser];
                const subjects = [
                    { id: 'toan', name: 'To√°n', icon: 'üßÆ', theory: 'üìò L√Ω thuy·∫øt', practice: 'üìù B√†i t·∫≠p' },
                    { id: 'van', name: 'VƒÉn', icon: 'üìñ', theory: 'üìö ƒê·ªçc hi·ªÉu', practice: '‚úçÔ∏è Vi·∫øt' },
                    { id: 'anh', name: 'Anh', icon: 'üá¨üáß', theory: 'üó£Ô∏è Ng·ªØ ph√°p', practice: 'üéß Nghe' },
                    { id: 'khtn', name: 'KHTN', icon: 'üî¨', theory: 'üß™ Th√≠ nghi·ªám', practice: 'üìä T√≠nh to√°n' }
                ];
                
                let html = '';
                subjects.forEach(subj => {
                    const data = user.subjects[subj.id];
                    const theoryDone = data?.theory || false;
                    const practiceDone = data?.practice || false;
                    
                    html += `
                        <div class="subject-detail">
                            <div class="subject-header">
                                <span class="subject-icon">${subj.icon}</span>
                                <span class="subject-title">${subj.name}</span>
                            </div>
                            
                            <div class="sub-tasks">
                                <div class="sub-task ${theoryDone ? 'done' : ''}" onclick="toggleSubjectPart('${subj.id}', 'theory')">
                                    <div class="sub-task-emoji">üìò</div>
                                    <div class="sub-task-name">L√Ω thuy·∫øt</div>
                                </div>
                                <div class="sub-task ${practiceDone ? 'done' : ''}" onclick="toggleSubjectPart('${subj.id}', 'practice')">
                                    <div class="sub-task-emoji">üìù</div>
                                    <div class="sub-task-name">B√†i t·∫≠p</div>
                                </div>
                            </div>
                            
                            <div class="progress-bar-container">
                                <div class="progress-label">
                                    <span>Ho√†n th√†nh</span>
                                    <span>${(theoryDone && practiceDone) ? '‚úÖ' : (theoryDone || practiceDone) ? '‚è≥' : '‚ùå'}</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${(theoryDone && practiceDone) ? '100%' : (theoryDone || practiceDone) ? '50%' : '0%'}"></div>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                subjectDetails.innerHTML = html;
                
                const allComplete = ['toan', 'van', 'anh', 'khtn'].every(subj => 
                    isSubjectComplete(user, subj)
                );
                
                if (!allComplete) {
                    warningMsg.innerHTML = `‚ö†Ô∏è Ho√†n th√†nh ƒë·ªß 4 m√¥n ƒë·ªÉ +1 streak`;
                } else {
                    warningMsg.innerHTML = `‚úÖ ƒê√É ƒê·ª¶ 4 M√îN! Click ƒë·ªÉ nh·∫≠n th∆∞·ªüng`;
                }
            }

            window.toggleSubjectPart = function(subject, part) {
                if (!currentUser) return;
                
                const user = accounts[currentUser];
                if (!user.subjects[subject]) user.subjects[subject] = { theory: false, practice: false };
                user.subjects[subject][part] = !user.subjects[subject][part];
                
                checkDailyCompletion(user);
                
                localStorage.setItem('accounts', JSON.stringify(accounts));
                renderSubjects();
                updateUI();
            };

            function checkDailyCompletion(user) {
                const allComplete = ['toan', 'van', 'anh', 'khtn'].every(subj => 
                    isSubjectComplete(user, subj)
                );
                
                const today = new Date().toDateString();
                
                if (allComplete && user.lastDate !== today) {
                    const reward = calculateReward(50, 20, user);
                    
                    user.exp += reward.exp;
                    user.diamonds += reward.diamonds;
                    user.stars = (user.stars || 0) + 5;
                    user.streak += 1;
                    
                    user.totalEarned.exp += reward.exp;
                    user.totalEarned.diamonds += reward.diamonds;
                    
                    if (user.streak > (user.highestStreakEver || 0)) {
                        user.highestStreakEver = user.streak;
                    }
                    
                    user.lastDate = today;
                    
                    // Ki·ªÉm tra streak rewards
                    streakRewards.forEach(reward => {
                        if (user.streak === reward.day) {
                            user.exp += reward.exp;
                            user.diamonds += reward.diamonds;
                            user.stars = (user.stars || 0) + (reward.stars || 0);
                            
                            if (reward.special === 'purplefire') {
                                user.purpleFire = true;
                            }
                            
                            alert(`üéâ ƒê·∫†T M·ªêC ${reward.day} NG√ÄY!\nNh·∫≠n: ${reward.exp} EXP + ${reward.diamonds} üíé + ${reward.stars || 0} ‚≠ê`);
                        }
                    });
                    
                    alert(`‚úÖ HO√ÄN TH√ÄNH! Nh·∫≠n: ${reward.exp} EXP, ${reward.diamonds} üíé, 5 ‚≠ê`);
                }
            }

            function renderPets() {
                if (!currentUser) return;
                
                const user = accounts[currentUser];
                if (!user.pets) user.pets = [];
                
                // Pet th∆∞·ªùng
                let petHtml = '';
                user.pets.forEach(petId => {
                    const pet = [...NORMAL_PETS, ...MYTHICAL_PETS].find(p => p.id === petId);
                    if (pet) {
                        petHtml += `
                            <div class="pet-card ${user.equippedPet === petId ? 'equipped' : ''}" onclick="equipPet('${petId}')">
                                <div class="pet-emoji">${pet.emoji}</div>
                                <div class="pet-name">${pet.name}</div>
                                <div class="pet-buff">${pet.buff.exp ? '‚ú® x' + pet.buff.exp : ''}</div>
                            </div>
                        `;
                    }
                });
                petInventory.innerHTML = petHtml || '<div style="text-align: center; padding: 20px;">Ch∆∞a c√≥ pet</div>';
                
                // Pet huy·ªÅn tho·∫°i
                let mythHtml = '';
                MYTHICAL_PETS.forEach(pet => {
                    const owned = user.pets.includes(pet.id);
                    mythHtml += `
                        <div class="pet-card" onclick="${owned ? `equipPet('${pet.id}')` : `buyMythicalPet('${pet.id}')`}">
                            <div class="pet-emoji">${pet.emoji}</div>
                            <div class="pet-name">${pet.name}</div>
                            <div class="pet-buff">${pet.description}</div>
                            <div class="pet-price">${owned ? 'ƒê√£ s·ªü h·ªØu' : 'üíé' + pet.price}</div>
                            <div class="pet-mythical">üëë</div>
                        </div>
                    `;
                });
                mythicalPets.innerHTML = mythHtml;
                
                // Shop pet
                let shopHtml = '';
                NORMAL_PETS.forEach(pet => {
                    if (!user.pets.includes(pet.id)) {
                        shopHtml += `
                            <div class="shop-item" onclick="buyPet('${pet.id}')">
                                <div class="shop-item-emoji">${pet.emoji}</div>
                                <div class="shop-item-name">${pet.name}</div>
                                <div class="shop-item-price">üíé${pet.price}</div>
                            </div>
                        `;
                    }
                });
                petShop.innerHTML = shopHtml || '<div style="text-align: center;">ƒê√£ mua h·∫øt pet!</div>';
            }

            window.buyPet = function(petId) {
                if (!currentUser) return;
                
                const user = accounts[currentUser];
                const pet = NORMAL_PETS.find(p => p.id === petId);
                
                if (!pet) return;
                
                if (user.diamonds >= pet.price) {
                    user.diamonds -= pet.price;
                    if (!user.pets) user.pets = [];
                    user.pets.push(petId);
                    
                    localStorage.setItem('accounts', JSON.stringify(accounts));
                    renderPets();
                    updateUI();
                    alert(`‚úÖ Mua th√†nh c√¥ng ${pet.name}!`);
                } else {
                    alert('‚ùå Kh√¥ng ƒë·ªß kim c∆∞∆°ng!');
                }
            };

            window.buyMythicalPet = function(petId) {
                if (!currentUser) return;
                
                const user = accounts[currentUser];
                const pet = MYTHICAL_PETS.find(p => p.id === petId);
                
                if (!pet) return;
                
                if (user.diamonds >= pet.price) {
                    user.diamonds -= pet.price;
                    if (!user.pets) user.pets = [];
                    user.pets.push(petId);
                    
                    user.stars = (user.stars || 0) + 1000;
                    user.exp += 5000;
                    
                    localStorage.setItem('accounts', JSON.stringify(accounts));
                    renderPets();
                    updateUI();
                    alert(`‚ú® MUA PET HUY·ªÄN THO·∫†I! Nh·∫≠n th√™m 1000‚≠ê v√† 5000 EXP!`);
                } else {
                    alert('‚ùå Kh√¥ng ƒë·ªß kim c∆∞∆°ng!');
                }
            };

            window.equipPet = function(petId) {
                if (!currentUser) return;
                
                const user = accounts[currentUser];
                user.equippedPet = user.equippedPet === petId ? null : petId;
                
                localStorage.setItem('accounts', JSON.stringify(accounts));
                renderPets();
                updateUI();
            };

            function renderFriendLeaderboard() {
                if (!currentUser) return;
                
                const user = accounts[currentUser];
                const friends = [currentUser, ...(user.friends || [])]
                    .map(name => ({ name, data: accounts[name] }))
                    .filter(f => f.data)
                    .sort((a, b) => (b.data?.streak || 0) - (a.data?.streak || 0));
                
                let html = '';
                friends.forEach((f, index) => {
                    html += `
                        <div class="friend-leaderboard-item">
                            <div class="friend-rank-badge">${index + 1}</div>
                            <span class="friend-name">${f.name} ${index === 0 ? 'üëë' : ''}</span>
                            <span style="flex: 1; text-align: right; color: gold;">üî• ${f.data?.streak || 0}</span>
                        </div>
                    `;
                });
                
                friendLeaderboard.innerHTML = html;
            }

            function renderCups() {
                const now = new Date();
                const month = now.getMonth();
                
                let html = '';
                for (let i = 0; i < 3; i++) {
                    const cupMonth = (month + i) % 12;
                    const cup = MONTHLY_CUPS[cupMonth];
                    html += `
                        <div class="cup-item">
                            <div class="cup-emoji">${cup.emoji}</div>
                            <div class="cup-name">${cup.name}</div>
                        </div>
                    `;
                }
                
                cupShowcase.innerHTML = html;
                
                // Global leaderboard
                let globalHtml = '';
                const topPlayers = Object.values(accounts)
                    .sort((a, b) => (b?.streak || 0) - (a?.streak || 0))
                    .slice(0, 10);
                
                topPlayers.forEach((player, index) => {
                    globalHtml += `
                        <div class="friend-leaderboard-item">
                            <div class="friend-rank-badge">${index + 1}</div>
                            <span class="friend-name">${player?.name || '???'}</span>
                            <span style="flex: 1; text-align: right; color: gold;">üî• ${player?.streak || 0}</span>
                        </div>
                    `;
                });
                
                globalLeaderboard.innerHTML = globalHtml || '<div style="text-align: center;">Ch∆∞a c√≥ d·ªØ li·ªáu</div>';
            }

            function renderShop() {
                if (!currentUser) return;
                
                let html = '';
                const shuffled = [...shopItems].sort(() => 0.5 - Math.random());
                const selectedItems = shuffled.slice(0, 12);
                
                selectedItems.forEach(item => {
                    html += `
                        <div class="shop-item" onclick="buyShopItem(${JSON.stringify(item).replace(/"/g, '&quot;')})">
                            <div class="shop-item-emoji">${item.emoji}</div>
                            <div class="shop-item-name">${item.name}</div>
                            <div class="shop-item-price">üíé${item.price}</div>
                        </div>
                    `;
                });
                
                shopGrid.innerHTML = html;
                
                // Inventory
                const user = accounts[currentUser];
                if (!user.inventory) user.inventory = [];
                
                let invHtml = '';
                user.inventory.forEach((item, index) => {
                    if (typeof item === 'object') {
                        invHtml += `
                            <div class="inventory-item" onclick="useItem(${index})">
                                <div class="inventory-item-emoji">${item.emoji || 'üì¶'}</div>
                                <div class="inventory-item-name">${item.name}</div>
                                <div class="inventory-item-count">${item.active ? '‚úÖ' : 'üí§'}</div>
                            </div>
                        `;
                    }
                });
                
                inventoryGrid.innerHTML = invHtml || '<div style="text-align: center; grid-column: span 4;">Kho ƒë·ªì tr·ªëng</div>';
            }

            window.buyShopItem = function(item) {
                if (!currentUser) return;
                
                const user = accounts[currentUser];
                
                if (user.diamonds >= item.price) {
                    user.diamonds -= item.price;
                    
                    if (!user.inventory) user.inventory = [];
                    
                    const newItem = {
                        ...item,
                        active: false,
                        purchased: new Date().toDateString()
                    };
                    
                    user.inventory.push(newItem);
                    
                    if (item.type === 'exp') {
                        user.exp += item.value;
                    } else if (item.type === 'diamonds') {
                        user.diamonds += item.value;
                    } else if (item.type === 'stars') {
                        user.stars = (user.stars || 0) + item.value;
                    } else if (item.type === 'boost') {
                        user.streak += item.value;
                    }
                    
                    localStorage.setItem('accounts', JSON.stringify(accounts));
                    renderShop();
                    updateUI();
                    alert(`‚úÖ Mua th√†nh c√¥ng: ${item.name}`);
                } else {
                    alert('‚ùå Kh√¥ng ƒë·ªß kim c∆∞∆°ng!');
                }
            };

            window.useItem = function(index) {
                if (!currentUser) return;
                
                const user = accounts[currentUser];
                const item = user.inventory[index];
                
                if (item.type === 'exp_boost' || item.type === 'diamond_boost') {
                    item.active = !item.active;
                    alert(`${item.active ? '‚úÖ ƒê√£ b·∫≠t' : 'üí§ ƒê√£ t·∫Øt'} ${item.name}`);
                }
                
                localStorage.setItem('accounts', JSON.stringify(accounts));
                renderShop();
                updateUI();
            };

            // T√¨m b·∫°n b√®
            searchFriendBtn.addEventListener('click', () => {
                const searchName = searchFriendInput.value.trim();
                
                if (!searchName) {
                    searchFriendResult.innerHTML = '‚ùå Vui l√≤ng nh·∫≠p t√™n';
                    return;
                }
                
                if (!accounts[searchName]) {
                    searchFriendResult.innerHTML = '‚ùå Kh√¥ng t√¨m th·∫•y';
                    return;
                }
                
                if (searchName === currentUser) {
                    searchFriendResult.innerHTML = '‚ùå Kh√¥ng th·ªÉ k·∫øt b·∫°n v·ªõi ch√≠nh m√¨nh';
                    return;
                }
                
                const user = accounts[currentUser];
                if (!user.friends) user.friends = [];
                
                if (user.friends.includes(searchName)) {
                    searchFriendResult.innerHTML = '‚úÖ ƒê√£ l√† b·∫°n b√®';
                    return;
                }
                
                const friendRank = getRank(accounts[searchName].exp);
                searchFriendResult.innerHTML = `
                    ‚úÖ T√¨m th·∫•y: ${searchName}<br>
                    üî• Streak: ${accounts[searchName].streak}<br>
                    üèÜ Rank: ${friendRank.name}<br>
                    <button class="btn purple small" onclick="addFriend('${searchName}')">‚ûï K·∫æT B·∫†N</button>
                `;
            });

            window.addFriend = function(friendName) {
                if (!currentUser) return;
                
                const user = accounts[currentUser];
                if (!user.friends) user.friends = [];
                
                if (!user.friends.includes(friendName)) {
                    user.friends.push(friendName);
                    
                    if (!accounts[friendName].friends) accounts[friendName].friends = [];
                    if (!accounts[friendName].friends.includes(currentUser)) {
                        accounts[friendName].friends.push(currentUser);
                    }
                    
                    localStorage.setItem('accounts', JSON.stringify(accounts));
                    
                    searchFriendResult.innerHTML = `‚úÖ ƒê√£ k·∫øt b·∫°n v·ªõi ${friendName}`;
                    searchFriendInput.value = '';
                    
                    renderFriendLeaderboard();
                    updateFriendList();
                }
            };

            function updateFriendList() {
                if (!currentUser) return;
                
                const user = accounts[currentUser];
                if (!user.friends) user.friends = [];
                
                if (user.friends.length === 0) {
                    friendListContainer.innerHTML = '<div style="text-align: center; padding: 20px;">üë• Ch∆∞a c√≥ b·∫°n b√®</div>';
                    return;
                }
                
                let html = '';
                user.friends.forEach(friend => {
                    const friendData = accounts[friend];
                    if (friendData) {
                        html += `
                            <div class="friend-item">
                                <div>
                                    <span class="friend-name">${friend}</span>
                                    <span class="friend-streak"> üî• ${friendData.streak}</span>
                                </div>
                                <div class="friend-actions">
                                    <button onclick="removeFriend('${friend}')">‚ùå</button>
                                </div>
                            </div>
                        `;
                    }
                });
                
                friendListContainer.innerHTML = html;
            }

            window.removeFriend = function(friendName) {
                if (!currentUser) return;
                
                if (confirm(`X√≥a ${friendName} kh·ªèi danh s√°ch b·∫°n b√®?`)) {
                    const user = accounts[currentUser];
                    user.friends = user.friends.filter(f => f !== friendName);
                    
                    if (accounts[friendName]) {
                        accounts[friendName].friends = accounts[friendName].friends.filter(f => f !== currentUser);
                    }
                    
                    localStorage.setItem('accounts', JSON.stringify(accounts));
                    
                    renderFriendLeaderboard();
                    updateFriendList();
                }
            };

            function updateUI() {
                if (!currentUser) return;
                
                const user = accounts[currentUser];
                const buffs = calculateBuffs(user);
                const days = getDaysUntilReset();
                const rank = getRank(user.exp);
                
                daysUntilReset.textContent = days;
                resetDays.textContent = days;
                streakNum.textContent = user.streak || 0;
                diamondNum.textContent = user.diamonds || 0;
                expNum.textContent = user.exp || 0;
                starNum.textContent = user.stars || 0;
                cupNum.textContent = user.cups?.length || 0;
                
                rankName.textContent = rank.name;
                
                const nextExp = getNextRankExp(user.exp);
                expDisplay.textContent = `${user.exp || 0}/${nextExp} EXP`;
                
                const prevExp = rank.minExp;
                const expNeeded = nextExp - prevExp;
                const expCurrent = (user.exp || 0) - prevExp;
                const percent = Math.min(100, (expCurrent / expNeeded) * 100);
                expBar.style.width = percent + '%';
                
                // Buff bar
                let buffHtml = '';
                if (buffs.exp > 1) buffHtml += `<div class="buff-item active">‚ú® x${buffs.exp.toFixed(1)}</div>`;
                if (buffs.diamond > 1) buffHtml += `<div class="buff-item active">üíé x${buffs.diamond.toFixed(1)}</div>`;
                if (buffs.luck) buffHtml += `<div class="buff-item active">üçÄ May m·∫Øn</div>`;
                if (user.buffs?.rebirth) buffHtml += `<div class="buff-item active">‚ôªÔ∏è H·ªìi sinh</div>`;
                buffBar.innerHTML = buffHtml || '<div class="buff-item">Kh√¥ng buff</div>';
                
                // Current pet
                if (user.equippedPet) {
                    const pet = [...NORMAL_PETS, ...MYTHICAL_PETS].find(p => p.id === user.equippedPet);
                    if (pet) {
                        currentPetDisplay.innerHTML = `
                            <div style="text-align: center;">
                                <div style="font-size: 48px; animation: petFloat 2s infinite;">${pet.emoji}</div>
                                <div style="font-weight: 700;">${pet.name}</div>
                                <div style="font-size: 12px;">${pet.description || ''}</div>
                            </div>
                        `;
                    }
                } else {
                    currentPetDisplay.innerHTML = '<div style="text-align: center; color: #b0c0ff;">Trang b·ªã pet ƒë·ªÉ nh·∫≠n buff</div>';
                }
                
                // Milestone
                const achieved = streakRewards.filter(r => r.day <= (user.streak || 0)).pop();
                if (achieved) {
                    milestoneBox.innerHTML = `
                        <div class="gift">
                            <div class="gift-emoji">${achieved.emoji}</div>
                            <div class="gift-text">M·ªëc ${achieved.day}: ${achieved.name}</div>
                            <div class="gift-reward">
                                <span>‚ú® +${achieved.exp} EXP</span>
                                <span>üíé +${achieved.diamonds}</span>
                                <span>‚≠ê +${achieved.stars || 0}</span>
                            </div>
                        </div>
                    `;
                } else {
                    milestoneBox.innerHTML = '<div class="locked">üîí ƒê·∫°t 2 ng√†y ƒë·ªÉ nh·∫≠n qu√†</div>';
                }
                
                renderSubjects();
                renderFriendLeaderboard();
                updateFriendList();
            }

            // Auto update
            setInterval(() => {
                if (currentUser) {
                    updateUI();
                }
            }, 1000);
        })();
    </script>
</body>
</html>
